<!DOCTYPE html>
<html>
<head>
    <title>Debug Reset Password API</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .result { padding: 15px; margin: 15px 0; border: 1px solid #ddd; background: #f8f9fa; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; color: #721c24; }
        .success { background-color: #d4edda; border-color: #c3e6cb; color: #155724; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 4px; }
        input { padding: 8px; margin: 5px; width: 400px; }
        textarea { width: 100%; height: 200px; font-family: monospace; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Debug Reset Password API</h1>
        
        <div>
            <h3>Test Reset Password</h3>
            <input type="text" id="token" placeholder="Token" value="2f94a05958e284df30053288e6d5e35659e88ed8223762dfaed2784106077522">
            <br>
            <input type="password" id="password" placeholder="New Password" value="test123">
            <br>
            <button onclick="testResetPassword()">Test Reset Password</button>
            <button onclick="checkToken()">Check Token Validity</button>
        </div>
        
        <div id="result"></div>
        
        <h3>Raw API Response:</h3>
        <textarea id="rawResponse" readonly></textarea>
    </div>

    <script>
        async function testResetPassword() {
            const token = document.getElementById('token').value;
            const password = document.getElementById('password').value;
            const resultDiv = document.getElementById('result');
            const rawDiv = document.getElementById('rawResponse');
            
            if (!token || !password) {
                alert('Please enter both token and password');
                return;
            }
            
            resultDiv.innerHTML = '<p>Testing reset password...</p>';
            
            try {
                console.log('Sending request with:', { token, password });
                
                const response = await fetch('http://localhost/FARMMASTER-Backend/api/users/reset-password', {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ 
                        token: token, 
                        password: password 
                    })
                });
                
                console.log('Response status:', response.status);
                console.log('Response headers:', response.headers);
                
                const responseText = await response.text();
                rawDiv.value = responseText;
                
                let data;
                try {
                    data = JSON.parse(responseText);
                } catch (e) {
                    data = { error: 'Invalid JSON response', raw: responseText };
                }
                
                console.log('Response data:', data);
                
                if (response.ok && data.status === 'success') {
                    resultDiv.innerHTML = `<div class="result success"><h4>✅ Success!</h4><p>${data.message}</p></div>`;
                } else {
                    resultDiv.innerHTML = `<div class="result error"><h4>❌ Failed</h4><p>Status: ${response.status}</p><p>Message: ${data.message || data.error || 'Unknown error'}</p></div>`;
                }
                
            } catch (error) {
                console.error('Request failed:', error);
                resultDiv.innerHTML = `<div class="result error"><h4>❌ Request Failed</h4><p>${error.message}</p></div>`;
                rawDiv.value = `Error: ${error.message}`;
            }
        }
        
        async function checkToken() {
            const token = document.getElementById('token').value;
            const resultDiv = document.getElementById('result');
            
            if (!token) {
                alert('Please enter a token');
                return;
            }
            
            resultDiv.innerHTML = '<p>Checking token validity...</p>';
            
            try {
                const response = await fetch('check_database_tokens.php');
                const text = await response.text();
                
                if (text.includes(token)) {
                    resultDiv.innerHTML = `<div class="result success"><h4>✅ Token Found in Database</h4><p>Your token exists in the database.</p></div>`;
                } else {
                    resultDiv.innerHTML = `<div class="result error"><h4>❌ Token Not Found</h4><p>Your token was not found in the database or may have expired.</p></div>`;
                }
                
            } catch (error) {
                resultDiv.innerHTML = `<div class="result error"><h4>❌ Check Failed</h4><p>${error.message}</p></div>`;
            }
        }
    </script>
</body>
</html>